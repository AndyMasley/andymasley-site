---
import Base from '@/layouts/Base.astro';
import { physicsTopics, getTotalVideoCount } from '@/lib/physics-videos';

const totalVideos = getTotalVideoCount();
---

<Base title="IB Physics" description="Video lectures for the full IB Physics curriculum">
  <div class="page-header">
    <h2 class="page-header__title">IB Physics</h2>
    <p class="page-header__description">
      I taught high school physics for 7 years and made and collected lots of online resources for my students. This page has everything useful I can share from my time teaching, most importantly the {totalVideos} animated video lectures I made for the IB Physics SL curriculum. 
    </p>
  </div>

  <hr class="divider" />

  <div class="section-title">Video Lectures</div>
  <div class="physics-intro">
    <p>
      Below are all my IB physics videos, also hosted on <a href="https://www.youtube.com/@andymasley" target="_blank" rel="noopener">My YouTube channel</a>. I only taught IB physics SL and don't have time to make HL videos right now. If you're looking for HL resources <a href="https://www.youtube.com/@donerphysics" target="_blank" rel="noopener">Chris Doner</a> and <a href="https://www.youtube.com/@siriusrevision" target="_blank" rel="noopener">Sirius Revision</a> both have great videos on IB HL topics!
    </p>
    <p>
      I made these videos under the old curriculum. I reorganized them into the new curriculum. There's a chance there are some inconsistencies between the old and new curricula but so far not many have come up! A few topics are missing because they didn't exist under the old curriculum.
    </p>
  </div>

  {physicsTopics.map(topic => (
    <div class="top-dropdown">
      <button class="top-toggle" aria-expanded="false" data-section={topic.id}>
        <span class="top-arrow">&#9654;</span>
        <span class="top-title">{topic.name}</span>
        <span class="top-count">({topic.subtopics.reduce((sum, s) => sum + s.videos.length, 0)})</span>
      </button>
      <div class="top-content" data-content={topic.id} hidden>
        {topic.subtopics.map((subtopic, idx) => (
          <div class="subtopic-dropdown">
            <button class="subtopic-toggle" aria-expanded="false" data-subtopic={`${topic.id}-${idx}`}>
              <span class="subtopic-arrow">&#9654;</span>
              <span class="subtopic-title">{subtopic.name}</span>
              <span class="subtopic-count">({subtopic.videos.length})</span>
            </button>
            <div class="subtopic-content" data-subcontent={`${topic.id}-${idx}`} hidden>
              {subtopic.videos.map(video => (
                <div class="video-row">
                  <a href={video.url} target="_blank" rel="noopener" class="video-link">
                    {video.title}
                  </a>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  ))}

  <hr class="divider" />

  <div class="back-link">
    <a href="/">‚Üê home</a>
  </div>
</Base>

<style>
  .section-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 12px;
  }

  .physics-intro {
    font-size: 0.875rem;
    color: var(--text);
    margin-bottom: 1.5rem;
  }

  .physics-intro p {
    margin-bottom: 0.75em;
  }

  .physics-intro a {
    color: var(--accent);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .physics-intro a:hover {
    text-decoration: none;
  }

  /* Top-level dropdowns */
  .top-dropdown {
    margin-bottom: 4px;
  }

  .top-toggle {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    padding: 8px 0;
    background: none;
    border: none;
    font-family: inherit;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text);
    cursor: pointer;
    text-align: left;
  }

  .top-toggle:hover {
    color: var(--accent);
  }

  .top-arrow {
    font-size: 0.6rem;
    transition: transform 0.2s ease;
    color: var(--dim);
    width: 10px;
  }

  .top-toggle[aria-expanded="true"] .top-arrow {
    transform: rotate(90deg);
  }

  .top-title {
    flex: 1;
  }

  .top-count {
    font-size: 0.7rem;
    font-weight: normal;
    color: var(--dim);
  }

  .top-content {
    padding-left: 20px;
    padding-bottom: 8px;
  }

  /* Subtopic dropdowns */
  .subtopic-dropdown {
    margin-bottom: 2px;
  }

  .subtopic-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 6px 0;
    background: none;
    border: none;
    font-family: inherit;
    font-size: 0.8rem;
    color: var(--text);
    cursor: pointer;
    text-align: left;
  }

  .subtopic-toggle:hover {
    color: var(--accent);
  }

  .subtopic-arrow {
    font-size: 0.5rem;
    transition: transform 0.2s ease;
    color: var(--dim);
    width: 8px;
  }

  .subtopic-toggle[aria-expanded="true"] .subtopic-arrow {
    transform: rotate(90deg);
  }

  .subtopic-title {
    flex: 1;
  }

  .subtopic-count {
    font-size: 0.65rem;
    color: var(--dim);
  }

  .subtopic-content {
    padding-left: 16px;
    padding-bottom: 8px;
    display: flex;
    flex-direction: column;
    gap: 3px;
  }

  .video-row {
    font-size: 0.8rem;
  }

  .video-link {
    color: var(--accent);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .video-link:hover {
    text-decoration: none;
  }

  /* Responsive */
  @media (max-width: 600px) {
    .top-content {
      padding-left: 12px;
    }

    .subtopic-content {
      padding-left: 12px;
    }
  }
</style>

<script>
  function initDropdowns() {
    // Top-level dropdown toggle
    document.querySelectorAll('.top-toggle').forEach(btn => {
      // Remove existing listeners by cloning
      const newBtn = btn.cloneNode(true);
      btn.parentNode?.replaceChild(newBtn, btn);

      newBtn.addEventListener('click', () => {
        const expanded = newBtn.getAttribute('aria-expanded') === 'true';
        newBtn.setAttribute('aria-expanded', String(!expanded));

        const section = newBtn.getAttribute('data-section');
        const content = document.querySelector(`[data-content="${section}"]`) as HTMLElement;
        if (content) {
          content.hidden = expanded;
        }
      });
    });

    // Subtopic dropdown toggle
    document.querySelectorAll('.subtopic-toggle').forEach(btn => {
      // Remove existing listeners by cloning
      const newBtn = btn.cloneNode(true);
      btn.parentNode?.replaceChild(newBtn, btn);

      newBtn.addEventListener('click', () => {
        const expanded = newBtn.getAttribute('aria-expanded') === 'true';
        newBtn.setAttribute('aria-expanded', String(!expanded));

        const subtopic = newBtn.getAttribute('data-subtopic');
        const content = document.querySelector(`[data-subcontent="${subtopic}"]`) as HTMLElement;
        if (content) {
          content.hidden = expanded;
        }
      });
    });
  }

  // Run on initial load
  initDropdowns();

  // Re-run after view transitions
  document.addEventListener('astro:page-load', initDropdowns);
</script>
